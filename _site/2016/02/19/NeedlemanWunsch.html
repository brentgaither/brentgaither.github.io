
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Needleman-Wunsch Algorithm</title>
  <meta name="description" content="In the last post I explained a very simple way to compare DNA strands. Although this does give us an idea of how similar two sequences are it has some proble...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <link rel="canonical" href="http://localhost:4000/2016/02/19/NeedlemanWunsch.html">
  <link rel="alternate" type="application/rss+xml" title="Brent Gaither" href="http://localhost:4000/feed.xml">
</head>

<nav class="nav nav-pills flex-column flex-sm-row">
  <a class="flex-sm-fill text-sm-center nav-link" href="/">Brent Gaither</a>
  <a class="flex-sm-fill text-sm-center nav-link" href="/about">About</a>
  <a class="flex-sm-fill text-sm-center nav-link" href="/PokemonGo">PokemonGo</a>
</nav>

<body>
<div class="row">
  <div class="col"></div>
  <div class="col-8">
    <header class="post-header">
  
  <span class="badge badge-success">bioinformatics</span>
  
  <h1 class="post-title" itemprop="name headline">Needleman-Wunsch Algorithm</h1>
  <p class="post-meta">
    <time datetime="2016-02-19T00:00:00-07:00" itemprop="datePublished">Feb 19, 2016
    </time>
    
  </p>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <title>Brentgaither.GitHub.io by brentgaither</title>
</header>

<div class="post-content" itemprop="articleBody">
  <p>In the last post I explained a very simple way to compare DNA strands. Although this does give us an idea of how similar two sequences are it has some problems. If a deletion or insertion occurs in two places the sequences will not align correctly. If the sequences are similar in some sections but have large insertions or deletions the last program will fail to properly detect how they should align. We can see patterns quickly with small sequences but to be able to anaylze a real genome you need to use computers. We can use a global alignment to align DNA more reliabliy.
A global alignment will try to create the best alignment for the entire length of the DNA sequences. This might not be the best choice though if you believe you have a subsection of your DNA in the strand you are comparing it to. This is best for sequences that represent the whole portion of the same DNA you are look at for example an entire gene in a downy woodpecker and the gene in a red headed woodpecker. Remember though this does not tell us anything about function of the gene just the differences in nucleotides.</p>

<p>I used the same read in method as last time to get sequences into our program. Next I am going to build a matrix to hold all of the posible ways for the sequences to align. This creates a matrix that has all of the alignments of the DNA strands and creates possible gaps in the sequence. If a gap is created we use a gap score to penalize because this means our sequence does not align as close.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buildGlobalMatrix</span><span class="p">(</span><span class="n">gap</span><span class="p">,</span> <span class="n">misMatch</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">sequenceOne</span><span class="p">,</span> <span class="n">sequenceTwo</span><span class="p">):</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequenceTwo</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> 
  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequenceOne</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
  <span class="n">rowLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequenceOne</span><span class="p">)</span>
  <span class="n">colLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequenceTwo</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">rowLength</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> 
      <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">colLength</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">matrix</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span> 
          <span class="k">if</span> <span class="p">(</span><span class="n">sequenceOne</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sequenceTwo</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
              <span class="n">score1</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">score1</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">misMatch</span><span class="p">)</span>
          <span class="n">score2</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
          <span class="n">score3</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
          <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">score1</span><span class="p">,</span> <span class="n">score2</span><span class="p">,</span> <span class="n">score3</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">matrix</span>
</code></pre></div></div>

<p>This next method is a bit hefty… To align the sequences we take in the matrix we just created then uses the gap score to see where gaps were placed. We start at the bottom right of the matrix and move to the top right to align the sequences. When nucleotides are aligned the matrix moves diagonally and horitonally or vertically when there are gaps in a sequence.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buildDirectional</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">rowLength</span><span class="p">,</span> <span class="n">colLength</span><span class="p">,</span> <span class="n">gapScore</span><span class="p">):</span>
  <span class="n">directionalString</span> <span class="o">=</span> <span class="s">''</span>
  <span class="n">currentRow</span> <span class="o">=</span> <span class="n">rowLength</span>
  <span class="n">currentCol</span> <span class="o">=</span> <span class="n">colLength</span>
  <span class="k">while</span><span class="p">(</span><span class="n">currentRow</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">currentCol</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
      <span class="k">if</span><span class="p">(</span><span class="n">currentRow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
          <span class="n">directionalString</span> <span class="o">=</span> <span class="n">directionalString</span> <span class="o">+</span> <span class="p">((</span><span class="s">'H'</span><span class="p">)</span> <span class="o">*</span> <span class="n">currentCol</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">directionalString</span>
      <span class="k">elif</span><span class="p">(</span><span class="n">currentCol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
          <span class="n">directionalString</span> <span class="o">=</span> <span class="n">directionalString</span> <span class="o">+</span> <span class="p">((</span><span class="s">'V'</span><span class="p">)</span> <span class="o">*</span> <span class="n">currentRow</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">directionalString</span>
      <span class="k">elif</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="n">currentRow</span><span class="p">][</span><span class="n">currentCol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> 
              <span class="nb">int</span><span class="p">(</span><span class="n">gapScore</span><span class="p">)</span> <span class="o">==</span> <span class="n">matrix</span><span class="p">[</span><span class="n">currentRow</span><span class="p">][</span><span class="n">currentCol</span><span class="p">]):</span>
          <span class="n">directionalString</span> <span class="o">=</span> <span class="n">directionalString</span> <span class="o">+</span> <span class="p">(</span><span class="s">'H'</span><span class="p">)</span>
          <span class="n">currentCol</span> <span class="o">=</span> <span class="n">currentCol</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">elif</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="n">currentRow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">currentCol</span><span class="p">]</span> <span class="o">+</span> 
              <span class="nb">int</span><span class="p">(</span><span class="n">gapScore</span><span class="p">)</span> <span class="o">==</span> <span class="n">matrix</span><span class="p">[</span><span class="n">currentRow</span><span class="p">][</span><span class="n">currentCol</span><span class="p">]):</span>
          <span class="n">directionalString</span> <span class="o">=</span> <span class="n">directionalString</span> <span class="o">+</span> <span class="p">(</span><span class="s">'V'</span><span class="p">)</span>
          <span class="n">currentRow</span> <span class="o">=</span> <span class="n">currentRow</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">directionalString</span> <span class="o">=</span> <span class="n">directionalString</span> <span class="o">+</span> <span class="p">(</span><span class="s">'D'</span><span class="p">)</span>
          <span class="n">currentRow</span> <span class="o">=</span> <span class="n">currentRow</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="n">currentCol</span> <span class="o">=</span> <span class="n">currentCol</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">directionalString</span>
</code></pre></div></div>

<p>To actually create the alignment these next two methods will take the directional string that was created and match the sequences together. The “-“s are just a way to see there is an insertion or deletion in one of the strands. The connector string makes the output a bit easier for us visually to understand how they align.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buildAlignment</span><span class="p">(</span><span class="n">sequenceOne</span><span class="p">,</span> <span class="n">sequenceTwo</span><span class="p">,</span> <span class="n">directionalString</span><span class="p">):</span>
  
  <span class="n">seq1Pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequenceOne</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">seq2Pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequenceTwo</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">dirPos</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">alignSeq1</span> <span class="o">=</span> <span class="s">''</span>
  <span class="n">alignSeq2</span> <span class="o">=</span> <span class="s">''</span>
  <span class="k">while</span><span class="p">(</span><span class="n">dirPos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">directionalString</span><span class="p">)):</span>
      
      <span class="k">if</span><span class="p">(</span><span class="n">directionalString</span><span class="p">[</span><span class="n">dirPos</span><span class="p">]</span> <span class="o">==</span> <span class="s">"D"</span><span class="p">):</span> 
          <span class="n">alignSeq1</span> <span class="o">=</span> <span class="n">sequenceOne</span><span class="p">[</span><span class="n">seq1Pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">alignSeq1</span>
          <span class="n">alignSeq2</span> <span class="o">=</span> <span class="n">sequenceTwo</span><span class="p">[</span><span class="n">seq2Pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">alignSeq2</span>
          <span class="n">seq1Pos</span> <span class="o">=</span> <span class="n">seq1Pos</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="n">seq2Pos</span> <span class="o">=</span> <span class="n">seq2Pos</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">elif</span><span class="p">(</span><span class="n">directionalString</span><span class="p">[</span><span class="n">dirPos</span><span class="p">]</span> <span class="o">==</span> <span class="s">"V"</span><span class="p">):</span>
          <span class="n">alignSeq1</span> <span class="o">=</span> <span class="n">sequenceOne</span><span class="p">[</span><span class="n">seq1Pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">alignSeq1</span>
          <span class="n">alignSeq2</span> <span class="o">=</span> <span class="s">'-'</span> <span class="o">+</span> <span class="n">alignSeq2</span>
          <span class="n">seq1Pos</span> <span class="o">=</span> <span class="n">seq1Pos</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">alignSeq1</span> <span class="o">=</span> <span class="s">'-'</span> <span class="o">+</span> <span class="n">alignSeq1</span> 
          <span class="n">alignSeq2</span> <span class="o">=</span> <span class="n">sequenceTwo</span><span class="p">[</span><span class="n">seq2Pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">alignSeq2</span>
          <span class="n">seq2Pos</span> <span class="o">=</span> <span class="n">seq2Pos</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">dirPos</span> <span class="o">=</span> <span class="n">dirPos</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="n">alSeq1List</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alignSeq1</span><span class="p">)</span>
  <span class="n">alSeq2List</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alignSeq2</span><span class="p">)</span>

  <span class="n">connectors</span><span class="p">,</span> <span class="n">alignmentScore</span> <span class="o">=</span> <span class="n">createConnections</span><span class="p">(</span><span class="n">alSeq1List</span><span class="p">,</span> <span class="n">alSeq2List</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">alignSeq1</span><span class="p">,</span> <span class="n">alignSeq2</span><span class="p">,</span> <span class="n">connectors</span><span class="p">,</span> <span class="n">alignmentScore</span>

<span class="k">def</span> <span class="nf">createConnections</span><span class="p">(</span><span class="n">alSeq1List</span><span class="p">,</span> <span class="n">alSeq2List</span><span class="p">):</span>

  <span class="n">connectors</span> <span class="o">=</span> <span class="s">""</span>
  <span class="n">alignmentScore</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">char1</span><span class="p">,</span> <span class="n">char2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alSeq1List</span><span class="p">,</span> <span class="n">alSeq2List</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">char1</span> <span class="o">==</span> <span class="n">char2</span><span class="p">:</span>
          <span class="n">connectors</span> <span class="o">=</span> <span class="n">connectors</span> <span class="o">+</span> <span class="s">"|"</span>
          <span class="n">alignmentScore</span> <span class="o">=</span> <span class="n">alignmentScore</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">char1</span> <span class="o">==</span> <span class="s">"-"</span> <span class="ow">or</span> <span class="n">char2</span> <span class="o">==</span> <span class="s">"-"</span><span class="p">:</span>
              <span class="n">connectors</span> <span class="o">=</span> <span class="n">connectors</span> <span class="o">+</span> <span class="s">" "</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">connectors</span> <span class="o">=</span> <span class="n">connectors</span> <span class="o">+</span> <span class="s">"."</span>

  <span class="k">return</span> <span class="n">connectors</span><span class="p">,</span> <span class="n">alignmentScore</span>
</code></pre></div></div>

<p>In my full project on github I have two other ways to align the sequences (locally and semi-globally). This last method just prints out the sequences nicely.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">printAlignment</span><span class="p">(</span><span class="n">alignSeq1</span><span class="p">,</span> <span class="n">alignSeq2</span><span class="p">,</span> <span class="n">connectors</span><span class="p">):</span>
  <span class="n">line</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">nucleotideCount</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">charPerLine</span> <span class="o">=</span> <span class="mi">50</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">alignSeq1</span><span class="p">),</span><span class="n">charPerLine</span><span class="p">):</span>
      <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nucleotideCount</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> 
        <span class="n">alignSeq1</span><span class="p">[</span><span class="n">line</span><span class="p">:</span><span class="n">line</span> <span class="o">+</span> <span class="n">charPerLine</span><span class="p">])</span>
      <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nucleotideCount</span><span class="p">))</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> 
          <span class="n">connectors</span><span class="p">[</span><span class="n">line</span><span class="p">:</span><span class="n">line</span> <span class="o">+</span> <span class="n">charPerLine</span><span class="p">])</span>
      <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nucleotideCount</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> 
        <span class="n">alignSeq2</span><span class="p">[</span><span class="n">line</span><span class="p">:</span><span class="n">line</span> <span class="o">+</span> <span class="n">charPerLine</span><span class="p">])</span>
      <span class="n">nucleotideCount</span> <span class="o">=</span> <span class="n">nucleotideCount</span> <span class="o">+</span> <span class="n">charPerLine</span>
</code></pre></div></div>

</div>

  </div>
  <div class="col"></div>
</div>
<footer>
  <p><img src="/images/octocat-icon.png"><a href="https://pages.github.com">GitHub Pages</a> Brent Gaither  brent[dot]w[dot]gaither[at]gmail[dot]com</p>

</footer>

</body>
